#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <fcntl.h>
#include <unistd.h>
#include <endian.h>
#include <errno.h>
#include <string.h>
#include <pcap/pcap.h>

int main(int argc, char *argv[])
{
    pcap_t *handle;			/* Session handle */
    char *dev;			/* The device to sniff on */

    char errbuf[PCAP_ERRBUF_SIZE];	/* Error string */

    /* check for capture device name on command-line */
	if (argc == 2) {
		dev = argv[1];
	}
	else {
		fprintf(stderr, "error: unrecognized command-line options\n\n");
		return 1;
	}
    
    /* Open the session in promiscuous mode */
    handle = pcap_open_live(dev, BUFSIZ, 1, 100, errbuf);
    if (handle == NULL) {
        fprintf(stderr, "Couldn't open device %s: %s\n", dev, errbuf);
        return(2);
    }

    unsigned char myPing[] = {
        0x5c, 0x92, 0x5e, 0xa3, 0x53, 0x02, 0x40, 0xee, 0x15, 0xb7, 0x24, 0xee, 0x08, 0x00, 0x45, 0x00,
        0x00, 0x26, 0x00, 0x01, 0x00, 0x00, 0x40, 0x01, 0xf7, 0x5a, 0xc0, 0xa8, 0x01, 0x21, 0xc0, 0xa8,
        0x01, 0x0a, 0x08, 0x00, 0x43, 0x0c, 0x1c, 0x6c, 0x00, 0x01, 0x6c, 0x69, 0x62, 0x6e, 0x65, 0x74,
        0x20, 0x3a, 0x44, 0x00
    };

    /*unsigned char radiotapheader[] = {
        0x00, 0x00, 0x38, 0x00, 0x2f, 0x40, 0x40, 0xa0,
        0x20, 0x08, 0x00, 0xa0, 0x20, 0x08, 0x00, 0x00,   
        0xf9, 0xe4, 0xd1, 0x9e, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x02, 0x85, 0x09, 0xa0, 0x00, 0xd8, 0x00,   
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xf9, 0xe4, 0xd1, 0x9e, 0x00, 0x00, 0x00, 0x00,   
        0x00, 0x00, 0x01, 0x01, 0xd1, 0x00, 0xd8, 0x01,
    };

    unsigned char ieee80211beacon[] = {
        0x80, 0x00, 0x00, 0x00, 
        0xff, 0xff, 0xff, 0xff, 0xff, 0xee,
        0x40, 0xee, 0x15, 0xb7, 0x24, 0x54,
        0x40, 0xee, 0x15, 0xb7, 0x24, 0x54,
        0xb0, 0x22
    };

    int sz = sizeof(radiotapheader) + sizeof(ieee80211beacon);
    unsigned char* packet = (unsigned char*) malloc(sz * sizeof(unsigned char));
    memcpy(packet, radiotapheader, sizeof(radiotapheader));
    memcpy(packet + sizeof(radiotapheader), ieee80211beacon, sizeof(ieee80211beacon));*/

    unsigned char ieee80211[] = {
        /*0x00, 0x00, 0x38, 0x00, 0x2f, 0x40, 0x40, 0xa0,
        0x20, 0x08, 0x00, 0xa0, 0x20, 0x08, 0x00, 0x00,   
        0xf9, 0xe4, 0xd1, 0x9e, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x02, 0x85, 0x09, 0xa0, 0x00, 0xd8, 0x00,   
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xf9, 0xe4, 0xd1, 0x9e, 0x00, 0x00, 0x00, 0x00,   
        0x00, 0x00, 0x01, 0x01, 0xd1, 0x00, 0xd8, 0x01,*/
        0x80, 0x00, 0x00, 0x00, 
        0xff, 0xff, 0xff, 0xff, 0xff, 0xee,
        0x40, 0xee, 0x15, 0xb7, 0x24, 0x54,
        0x40, 0xee, 0x15, 0xb7, 0x24, 0x54,
        0xb0, 0x22
    };


    if(pcap_inject(handle, &ieee80211, sizeof(ieee80211)) == -1) {
        fprintf(stderr, "pcap inject error\n");
        return(2);
    }
    
	/* cleanup */
	pcap_close(handle);
    //free(packet);
	printf("\nSend complete.\n");    
    
    return(0);
}